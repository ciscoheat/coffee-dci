(function(){var b,c,a;c=this;c.Ivento||(c.Ivento={});(a=c.Ivento).Dci||(a.Dci={});c.Ivento.Dci.Context=b=(function(){function d(){}d.prototype.bind=function(e){return d.bind(this,e)};d.prototype.unbind=function(e){if(e==null){e=null}return d.unbind(this,e)};d.setPromiseAdapter=function(e){d.promise=e.factory;d.unbindPromise=e.unbind;return d.isPromise=e.identify};d.promise=function(){return new c.promise.Promise()};d.unbindPromise=function(g,e){return g.then(e)};d.isPromise=function(e){return(e.then!=null)&&(e.done!=null)};d._isObject=function(e){return !!(e!==null&&typeof e==="object")};d._isFunction=function(e){return !!(e&&e.constructor&&e.call&&e.apply)};d._isRoleObject=function(f,e){return f[0]!=="_"&&this._isObject(e)};d._isRoleMethod=function(f,e){return f[0]!=="_"&&f!=="constructor"&&this._isFunction(e)};d.bind=function(f,r){var e,g,h,i,j,k,l,m,n,o,p,q,s;k=function(t){return t[0]!=="_"&&!(t==="constructor"||t==="bind"||t==="unbind")&&d._isFunction(f[t])};e=function(t){return d._bindingFor(f,t)};h=function(v,A){var u,w,x,y,z,t;u=e(A);x=u.__rolePlayer;w=function(C,D,B){if((B!=null)&&!(D!=null)){return B}if(!(B!=null)&&!(D!=null)){throw"No Role method or Object method '"+C+"' found."}if(!(B!=null)){u[C]=true}else{u[C]=B}return function(){var E,F;if(!(B!=null)){return D.apply(x,arguments)}F=arguments.callee.caller.__inContext;E=F===true||F===A;if(E){return D.apply(x,arguments)}else{return B.apply(x,arguments)}}};if(x!==null){t=f.constructor.prototype[A];for(y in t){z=t[y];if(d._isRoleMethod(y,z)){x[y]=w(y,z,x[y])}}u.__oldContext=x[u.__contextProperty];u.__oldPromise=x.promise;x[u.__contextProperty]=f;x.promise=f[v].__promise}return f[A]=x};i=function(u){var v,t;t=[];for(v in f.__isBound){t.push(h(u,v))}return t};s=function(t,u){d.unbind(t);if(u===void 0){return delete t.promise}else{return t.promise=u}};g=function(t){return function(){var v,w,x,u;v=f.promise;(u=f[t]).__promise||(u.__promise=d.promise());f.promise=f[t].__promise;i(t);w=null;try{w=f.constructor.prototype[t].apply(f,arguments);return w}finally{x=function(){return s(f,v)};if((w!=null)&&d.isPromise(w)){d.unbindPromise(w,x)}else{x()}}}};m=f.constructor.prototype;if(!(m.__isProtoBound!=null)){m.__isProtoBound=true;p={};for(l in m){j=m[l];if(k(l)){m[l].__inContext=true}else{if(d._isRoleObject(l,j)){q=l;for(o in j){n=j[o];if(!(d._isRoleMethod(o,n))){continue}m[l][o].__inContext=q;if(p[o]!=null){throw"Method name conflict in Roles '"+p[o]+"' and '"+q+"."+o+"'. Please prepend the Role names to the methods to avoid conflict."}else{p[o]=q+"."+o}}}}}}if(!(f.__isBound!=null)){f.__isBound={};m=f.constructor.prototype;for(l in m){j=m[l];if(k(l)){f[l]=g(l)}else{if(d._isRoleObject(l,j)){f[l]={}}}}}return{to:function(y,w){var x,z,t,u,v;if(w==null){w="context"}if(!(typeof y==="string")){throw"A Role must be bound as a string literal."}if(!(y in f)){throw"Role '"+y+"' not found in Context."}z=f.constructor.prototype[y];if(z._contract!=null){v=z._contract;for(t=0,u=v.length;t<u;t++){l=v[t];if(!(l in r)){throw"RolePlayer "+r+" didn't fulfill Role Contract with property '"+l+"'."}}}x=e(y);if((x!=null)&&(x.__rolePlayer!=null)&&x.__rolePlayer!==r){d.unbind(f,y)}return f.__isBound[y]=d._defaultBinding(r,w)}}};d.unbind=function(f,g){var h,i,e;if(g==null){g=null}i=function(p){var j,k,l,m,n,o,q;j=d._bindingFor(f,p);q=j.__rolePlayer;k=j.__contextProperty;if(q===null){return}for(o in j){l=j[o];if(o[0]!=="_"){if(l===true){delete q[o]}else{q[o]=l}}}m=j.__oldContext;if(m===void 0){delete q[k]}else{q[k]=m}n=j.__oldPromise;if(n===void 0){delete q.promise}else{q.promise=n}f.__isBound[p]=d._defaultBinding(q,k);return f[p]={}};if(!(g!=null)){e=[];for(h in f.__isBound){e.push(i(h))}return e}else{return i(g)}};d._bindingFor=function(e,f){return e.__isBound[f]};d._defaultBinding=function(f,e){return{__rolePlayer:f,__oldContext:null,__oldPromise:null,__contextProperty:e}};return d})();if(this.promise==null){(function(k){function l(d,e){return function(){return d.apply(e,arguments)}}function m(){this._callbacks=[]}m.prototype.then=function(e,f){var g=l(e,f);if(this._isdone){g(this.error,this.result)}else{this._callbacks.push(g)}};m.prototype.done=function(d,e){this._isdone=true;this.error=d;this.result=e;for(var f=0;f<this._callbacks.length;f++){this._callbacks[f](d,e)}this._callbacks=[]};function n(j){var u=j.length;var v=0;var w=new m();var x=[];var y=[];function z(d){return function(e,f){v+=1;x[d]=e;y[d]=f;if(v===u){w.done(x,y)}}}for(var A=0;A<u;A++){j[A]().then(z(A))}return w}function o(e,g,h){var i=new m();if(e.length===0){i.done(g,h)}else{e[0](g,h).then(function(d,f){e.splice(0,1);o(e,d,f).then(function(j,u){i.done(j,u)})})}return i}function p(e){var f="";if(typeof e==="string"){f=e}else{var g=encodeURIComponent;for(var h in e){if(e.hasOwnProperty(h)){f+="&"+g(h)+"="+g(e[h])}}}return f}function q(){var d;if(window.XMLHttpRequest){d=new XMLHttpRequest()}else{if(window.ActiveXObject){try{d=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){d=new ActiveXObject("Microsoft.XMLHTTP")}}}return d}function r(f,g,u,v){var w=new m();var x,y;u=u||{};v=v||{};try{x=q()}catch(z){w.done(-1,"");return w}y=p(u);if(f==="GET"&&y){g+="?"+y;y=null}x.open(f,g);x.setRequestHeader("Content-type","application/x-www-form-urlencoded");for(var A in v){if(v.hasOwnProperty(A)){x.setRequestHeader(A,v[A])}}x.onreadystatechange=function(){if(x.readyState===4){if(x.status===200){w.done(null,x.responseText)}else{w.done(x.status,"")}}};x.send(y);return w}function s(d){return function(e,f,g){return r(d,e,f,g)}}var t={Promise:m,join:n,chain:o,ajax:r,get:s("GET"),post:s("POST"),put:s("PUT"),del:s("DELETE")};if(typeof define==="function"&&define.amd){define(function(){return t})}else{k.promise=t}})(this)}}).call(this);