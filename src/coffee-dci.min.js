(function(){var c,d,b,a=[].indexOf||function(f){for(var e=0,g=this.length;e<g;e++){if(e in this&&this[e]===f){return e}}return -1};d=this;d.Ivento||(d.Ivento={});(b=d.Ivento).Dci||(b.Dci={});d.Ivento.Dci.Context=c=(function(){function e(){}e.prototype.bind=function(f){return e.bind(this,f)};e.prototype.unbind=function(f){if(f==null){f=null}return e.unbind(this,f)};e.promiseJsAdapter={factory:function(){return new promise.Promise()},unbind:function(h,g){return h.then(g)},identify:function(f){return(f.then!=null)&&(f.done!=null)}};e.jQueryAdapter={factory:function(){return jQuery.Deferred()},unbind:function(h,g){return h.always(g)},identify:function(f){return(f.always!=null)&&(f.done!=null)&&(f.fail!=null)}};e.setPromiseAdapter=function(f){e.promise=f.factory;e.unbindPromise=f.unbind;return e.isPromise=f.identify};e.promise=function(){return null};e.unbindPromise=function(h,g){};e.isPromise=function(f){return false};if(typeof jQuery!=="undefined"&&jQuery!==null){e.setPromiseAdapter(e.jQueryAdapter)}else{if(typeof promise!=="undefined"&&promise!==null){e.setPromiseAdapter(e.promiseJsAdapter)}}e._isObject=function(f){return !!(f!==null&&typeof f==="object")};e._isFunction=function(f){return !!(f&&f.constructor&&f.call&&f.apply)};e._isRoleObject=function(g,f){return g[0]!=="_"&&e._isObject(f)};e._isRoleMethod=function(g,f){return g[0]!=="_"&&g!=="constructor"&&e._isFunction(f)};e._reservedProperties=["bind","unbind","promise"];e.bind=function(h,s){var f,g,i,j,k,l,m,n,o,p,q,r,t;l=function(u){return u[0]!=="_"&&u!=="constructor"&&!(a.call(e._reservedProperties,u)>=0)&&e._isFunction(h[u])};g=function(u){return e._bindingFor(h,u)};j=function(A){var v,w,x,y,z,u;v=g(A);x=v.__rolePlayer;w=function(C){var B,D;B=x[C];D=h.constructor.prototype[A][C];if((B!=null)&&!(D!=null)){return B}if(!(B!=null)&&!(D!=null)){throw"No Role method or Object method '"+C+"' found."}if(!(B!=null)){v[C]=true}else{v[C]=B}return function(){var E,F;if(!(B!=null)){return D.apply(x,arguments)}F=arguments.callee.caller.__inContext;E=F===true||F===A;if(E){return D.apply(x,arguments)}else{return B.apply(x,arguments)}}};if(x!==null){u=h.constructor.prototype[A];for(y in u){z=u[y];if(e._isRoleMethod(y,z)){x[y]=w(y)}}v.__oldContext=x[v.__contextProperty];x[v.__contextProperty]=h}return h[A]=x};f=function(){var v,u;h.__oldPromise=h.promise;h.promise=e.promise();u=[];for(v in h.__bindings){u.push(j(v))}return u};t=function(){e.unbind(h);if(!(h.__oldPromise!=null)){return delete h.promise}else{return h.promise=h.__oldPromise}};i=function(u){return function(){var v;f();v=null;try{v=h.constructor.prototype[u].apply(h,arguments);return v}finally{if((v!=null)&&e.isPromise(v)){e.unbindPromise(v,t)}else{t()}}}};n=h.constructor.prototype;if(!(n.__isProtoBound!=null)){n.__isProtoBound=true;q={};for(m in n){k=n[m];if(n.hasOwnProperty(m)&&a.call(e._reservedProperties,m)>=0){throw"Property '"+m+"' is reserved in a Context object."}if(l(m)){n[m].__inContext=true}else{if(e._isRoleObject(m,k)){r=m;for(p in k){o=k[p];if(!(e._isRoleMethod(p,o))){continue}n[m][p].__inContext=r;if(q[p]!=null){throw"Method name conflict in Roles '"+q[p]+"' and '"+r+"."+p+"'. Please prepend the Role names to the methods to avoid conflict."}else{q[p]=r+"."+p}}}}}}if(!(h.__bindings!=null)){h.__bindings={};n=h.constructor.prototype;for(m in n){k=n[m];if(l(m)){h[m]=i(m)}else{if(e._isRoleObject(m,k)){h[m]={}}}}}return{to:function(B,x){var y,z,A,C,u,v,w;if(x==null){x="context"}if(!(typeof B==="string")){throw"A Role must be bound as a string literal."}if(!(B in h)){throw"Role '"+B+"' not found in Context."}C=h.constructor.prototype[B];if(s!==null&&(C._contract!=null)){w=C._contract;for(u=0,v=w.length;u<v;u++){m=w[u];if(m==="()"){if(!e._isFunction(s)){throw"RolePlayer "+s+" didn't fulfill Role Contract: Not a function."}}else{A=m.split(".");y=s;while(A.length){y=y[A.shift()];if(y===void 0){throw"RolePlayer "+s+" didn't fulfill Role Contract with property '"+m+"'."}}}}}z=g(B);if(((z!=null?z.__rolePlayer:void 0)!=null)&&z.__rolePlayer!==s){e.unbind(h,B)}return h.__bindings[B]=e._defaultBinding(s,x)}}};e.unbind=function(g,h){var i,j,f;if(h==null){h=null}j=function(p){var k,l,m,n,o,q;k=e._bindingFor(g,p);if(k.__rolePlayer===null){return}q=k.__rolePlayer;l=k.__contextProperty;o=function(s,u,t,r){if(r==null){r=void 0}if(t===r){return delete s[u]}else{return s[u]=t}};for(n in k){m=k[n];if(n[0]!=="_"){o(q,n,m,true)}}o(q,l,k.__oldContext);g.__bindings[p]=e._defaultBinding(q,l);return g[p]={}};if(!(h!=null)){f=[];for(i in g.__bindings){f.push(j(i))}return f}else{return j(h)}};e._bindingFor=function(f,g){return f.__bindings[g]};e._defaultBinding=function(g,f){return{__rolePlayer:g,__oldContext:null,__contextProperty:f}};return e})()}).call(this);