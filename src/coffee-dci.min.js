(function(){var b,c,a;c=this;c.Ivento||(c.Ivento={});(a=c.Ivento).Dci||(a.Dci={});c.Ivento.Dci.Context=b=(function(){function d(){}d.prototype.bind=function(e){return d.bind(this,e)};d.prototype.unbind=function(e){if(e==null){e=null}return d.unbind(this,e)};d.promiseJsAdapter={factory:function(){return new promise.Promise()},unbind:function(g,e){return g.then(e)},identify:function(e){return(e.then!=null)&&(e.done!=null)}};d.jQueryAdapter={factory:function(){return jQuery.Deferred()},unbind:function(g,e){return g.always(e)},identify:function(e){return(e.always!=null)&&(e.done!=null)&&(e.fail!=null)}};d.setPromiseAdapter=function(e){d.promise=e.factory;d.unbindPromise=e.unbind;return d.isPromise=e.identify};d.promise=function(){return null};d.unbindPromise=function(g,e){};d.isPromise=function(e){return false};if(typeof jQuery!=="undefined"&&jQuery!==null){d.setPromiseAdapter(d.jQueryAdapter)}else{if(typeof promise!=="undefined"&&promise!==null){d.setPromiseAdapter(d.promiseJsAdapter)}}d._isObject=function(e){return !!(e!==null&&typeof e==="object")};d._isFunction=function(e){return !!(e&&e.constructor&&e.call&&e.apply)};d._isRoleObject=function(f,e){return f[0]!=="_"&&d._isObject(e)};d._isRoleMethod=function(f,e){return f[0]!=="_"&&f!=="constructor"&&d._isFunction(e)};d.bind=function(g,r){var e,f,h,i,j,k,l,m,n,o,p,q,s;k=function(t){return t[0]!=="_"&&!(t==="constructor"||t==="bind"||t==="unbind")&&d._isFunction(g[t])};f=function(t){return d._bindingFor(g,t)};i=function(z){var u,v,w,x,y,t;u=f(z);w=u.__rolePlayer;v=function(B){var A,C;A=w[B];C=g.constructor.prototype[z][B];if((A!=null)&&!(C!=null)){return A}if(!(A!=null)&&!(C!=null)){throw"No Role method or Object method '"+B+"' found."}if(!(A!=null)){u[B]=true}else{u[B]=A}return function(){var D,E;if(!(A!=null)){return C.apply(w,arguments)}E=arguments.callee.caller.__inContext;D=E===true||E===z;if(D){return C.apply(w,arguments)}else{return A.apply(w,arguments)}}};if(w!==null){t=g.constructor.prototype[z];for(x in t){y=t[x];if(d._isRoleMethod(x,y)){w[x]=v(x)}}u.__oldContext=w[u.__contextProperty];u.__oldPromise=w.promise;w[u.__contextProperty]=g;w.promise=g.promise}return g[z]=w};e=function(){var u,t;g.__oldPromise=g.promise;g.promise=d.promise();t=[];for(u in g.__isBound){t.push(i(u))}return t};s=function(){d.unbind(g);if(!(g.__oldPromise!=null)){return delete g.promise}else{return g.promise=g.__oldPromise}};h=function(t){return function(){var u;e();u=null;try{u=g.constructor.prototype[t].apply(g,arguments);return u}finally{if((u!=null)&&d.isPromise(u)){d.unbindPromise(u,s)}else{s()}}}};m=g.constructor.prototype;if(!(m.__isProtoBound!=null)){m.__isProtoBound=true;p={};for(l in m){j=m[l];if(k(l)){m[l].__inContext=true}else{if(d._isRoleObject(l,j)){q=l;for(o in j){n=j[o];if(!(d._isRoleMethod(o,n))){continue}m[l][o].__inContext=q;if(p[o]!=null){throw"Method name conflict in Roles '"+p[o]+"' and '"+q+"."+o+"'. Please prepend the Role names to the methods to avoid conflict."}else{p[o]=q+"."+o}}}}}}if(!(g.__isBound!=null)){g.__isBound={};m=g.constructor.prototype;for(l in m){j=m[l];if(k(l)){g[l]=h(l)}else{if(d._isRoleObject(l,j)){g[l]={}}}}}return{to:function(A,w){var x,y,z,B,t,u,v;if(w==null){w="context"}if(!(typeof A==="string")){throw"A Role must be bound as a string literal."}if(!(A in g)){throw"Role '"+A+"' not found in Context."}B=g.constructor.prototype[A];if(r!==null&&(B._contract!=null)){v=B._contract;for(t=0,u=v.length;t<u;t++){l=v[t];z=l.split(".");x=r;while(z.length){x=x[z.shift()];if(x===void 0){throw"RolePlayer "+r+" didn't fulfill Role Contract with property '"+l+"'."}}}}y=f(A);if(((y!=null?y.__rolePlayer:void 0)!=null)&&y.__rolePlayer!==r){d.unbind(g,A)}return g.__isBound[A]=d._defaultBinding(r,w)}}};d.unbind=function(f,g){var h,i,e;if(g==null){g=null}i=function(o){var j,k,l,m,n,p;j=d._bindingFor(f,o);if(j.__rolePlayer===null){return}p=j.__rolePlayer;k=j.__contextProperty;n=function(r,t,s,q){if(q==null){q=void 0}if(s===q){return delete r[t]}else{return r[t]=s}};for(m in j){l=j[m];if(m[0]!=="_"){n(p,m,l,true)}}n(p,k,j.__oldContext);n(p,"promise",j.__oldPromise);f.__isBound[o]=d._defaultBinding(p,k);return f[o]={}};if(!(g!=null)){e=[];for(h in f.__isBound){e.push(i(h))}return e}else{return i(g)}};d._bindingFor=function(e,f){return e.__isBound[f]};d._defaultBinding=function(f,e){return{__rolePlayer:f,__oldContext:null,__oldPromise:null,__contextProperty:e}};return d})()}).call(this);