(function(){var b,c,a;c=this;c.Ivento||(c.Ivento={});(a=c.Ivento).Dci||(a.Dci={});c.Ivento.Dci.Context=b=(function(){function d(){}d.prototype.bind=function(e){return d.bind(this,e)};d.prototype.unbind=function(e){if(e==null){e=null}return d.unbind(this,e)};d.promise=function(){return new c.promise.Promise()};d.unbindPromise=function(e){return e.then};d.isPromise=function(e){return(e.then!=null)&&(e.done!=null)};d._isObject=function(e){return !!(e!==null&&typeof e==="object")};d._isFunction=function(e){return !!(e&&e.constructor&&e.call&&e.apply)};d._isRoleObject=function(e){return this._isObject(e)};d._isRoleMethod=function(f,e){return f[0]!=="_"&&f!=="constructor"&&this._isFunction(e)};d.bind=function(e,q){var f,g,h,i,j,k,l,m,n,o,p,r;j=function(s){return s[0]!=="_"&&!(s==="constructor"||s==="bind"||s==="unbind"||s==="promise")&&d._isFunction(e[s])};g=function(u,z,A){var t,v,w,x,y,s;t=e.__isBound[z];v=function(C,D,B){if((B!=null)&&!(D!=null)){return B}if(!(B!=null)&&!(D!=null)){throw"No Role method or Object method '"+C+"' found."}if(!(B!=null)){t[C]=true}else{t[C]=B}return function(){var E,F;if(!(B!=null)){return D.apply(A,arguments)}F=arguments.callee.caller.__inContext;E=F===true||F===z;if(E){return D.apply(A,arguments)}else{return B.apply(A,arguments)}}};w=t.__rolePlayer;if((w!=null)&&w!==A){d.unbind(e,z)}s=e.constructor.prototype[z];for(x in s){y=s[x];if(d._isRoleMethod(x,y)){A[x]=v(x,y,A[x])}}t.__oldContext=A[t.__contextProperty];t.__oldPromise=A.promise;A[t.__contextProperty]=e;A.promise=e[u].__promise;return e[z]=A};h=function(t){var u,s;s=[];for(u in e.__isBound){s.push(g(t,u,e.__isBound[u].__rolePlayer))}return s};r=function(s,t){d.unbind(s);if(t===void 0){return delete s.promise}else{return s.promise=t}};f=function(s){return function(){var u,v,w,t;u=e.promise;(t=e[s]).__promise||(t.__promise=d.promise());e.promise=e[s].__promise;h(s);v=null;try{v=e.constructor.prototype[s].apply(e,arguments);return v}finally{w=function(){return r(e,u)};if((v!=null)&&d.isPromise(v)){d.unbindPromise(v).call(v,w)}else{w()}}}};l=e.constructor.prototype;if(!(l.__isProtoBound!=null)){l.__isProtoBound=true;o={};for(k in l){i=l[k];if(j(k)){l[k].__inContext=true}else{if(d._isRoleObject(i)){p=k;for(n in i){m=i[n];if(!(d._isRoleMethod(n,m))){continue}l[k][n].__inContext=p;if(o[n]!=null){throw"Method name conflict in Roles '"+o[n]+"' and '"+p+"."+n+"'. Please prepend the Role names to the methods to avoid conflict."}else{o[n]=p+"."+n}}}}}}if(!(e.__isBound!=null)){e.__isBound={};l=e.constructor.prototype;for(k in l){i=l[k];if(j(k)){e[k]=f(k)}else{if(d._isRoleObject(i)){e[k]={}}}}}return{to:function(w,v){var x,s,t,u;if(v==null){v="context"}p=null;for(k in e){i=e[k];if(i===w){p=k;break}}if(!p){throw"Role for RolePlayer not found in Context."}x=e.constructor.prototype[p];if(x._contract!=null){u=x._contract;for(s=0,t=u.length;s<t;s++){k=u[s];if(!(k in q)){throw"RolePlayer "+q+" didn't fulfill Role Contract with property '"+k+"'."}}}return e.__isBound[p]=d._defaultBinding(q,v)}}};d.unbind=function(f,g){var h,i,e;if(g==null){g=null}i=function(p){var j,k,l,m,n,o,q;j=f.__isBound[p];q=j.__rolePlayer;k=j.__contextProperty;for(o in j){l=j[o];if(o[0]!=="_"){if(l===true){delete q[o]}else{q[o]=l}}}m=j.__oldContext;if(m===void 0){delete q[k]}else{q[k]=m}n=j.__oldPromise;if(n===void 0){delete q.promise}else{q.promise=n}return f.__isBound[p]=d._defaultBinding(q,k)};if(!(g!=null)){e=[];for(h in f.__isBound){e.push(i(h))}return e}else{return i(g)}};d._defaultBinding=function(f,e){return{__rolePlayer:f,__oldContext:null,__oldPromise:null,__contextProperty:e}};return d})();if(this.promise==null){(function(k){function l(d,e){return function(){return d.apply(e,arguments)}}function m(){this._callbacks=[]}m.prototype.then=function(e,f){var g=l(e,f);if(this._isdone){g(this.error,this.result)}else{this._callbacks.push(g)}};m.prototype.done=function(d,e){this._isdone=true;this.error=d;this.result=e;for(var f=0;f<this._callbacks.length;f++){this._callbacks[f](d,e)}this._callbacks=[]};function n(j){var u=j.length;var v=0;var w=new m();var x=[];var y=[];function z(d){return function(e,f){v+=1;x[d]=e;y[d]=f;if(v===u){w.done(x,y)}}}for(var A=0;A<u;A++){j[A]().then(z(A))}return w}function o(e,g,h){var i=new m();if(e.length===0){i.done(g,h)}else{e[0](g,h).then(function(d,f){e.splice(0,1);o(e,d,f).then(function(j,u){i.done(j,u)})})}return i}function p(e){var f="";if(typeof e==="string"){f=e}else{var g=encodeURIComponent;for(var h in e){if(e.hasOwnProperty(h)){f+="&"+g(h)+"="+g(e[h])}}}return f}function q(){var d;if(window.XMLHttpRequest){d=new XMLHttpRequest()}else{if(window.ActiveXObject){try{d=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){d=new ActiveXObject("Microsoft.XMLHTTP")}}}return d}function r(f,g,u,v){var w=new m();var x,y;u=u||{};v=v||{};try{x=q()}catch(z){w.done(-1,"");return w}y=p(u);if(f==="GET"&&y){g+="?"+y;y=null}x.open(f,g);x.setRequestHeader("Content-type","application/x-www-form-urlencoded");for(var A in v){if(v.hasOwnProperty(A)){x.setRequestHeader(A,v[A])}}x.onreadystatechange=function(){if(x.readyState===4){if(x.status===200){w.done(null,x.responseText)}else{w.done(x.status,"")}}};x.send(y);return w}function s(d){return function(e,f,g){return r(d,e,f,g)}}var t={Promise:m,join:n,chain:o,ajax:r,get:s("GET"),post:s("POST"),put:s("PUT"),del:s("DELETE")};if(typeof define==="function"&&define.amd){define(function(){return t})}else{k.promise=t}})(this)}}).call(this);