(function(){var b,c,a;c=this;c.Ivento||(c.Ivento={});(a=c.Ivento).Dci||(a.Dci={});c.Ivento.Dci.Context=b=(function(){function d(){}d.prototype.bind=function(f,e){if(e==null){e="context"}return d.bind(this,f,e)};d.prototype.unbind=function(e){if(e==null){e=null}return d.unbind(this,e)};d.promise=function(){return new c.promise.Promise()};d.unbindPromise=function(e){return e.then};d.isPromise=function(e){return(e.then!=null)&&(e.done!=null)};d._isObject=function(e){return !!(e!==null&&typeof e==="object")};d._isFunction=function(e){return !!(e&&e.constructor&&e.call&&e.apply)};d._isRoleObject=function(e){return this._isObject(e)};d._isRoleMethod=function(f,e){return f[0]!=="_"&&f!=="constructor"&&this._isFunction(e)};d.bind=function(e,r,f){var g,h,i,j,k,l,m,n,o,p,q;if(f==null){f="context"}k=function(s){return s[0]!=="_"&&!(s==="constructor"||s==="bind"||s==="unbind"||s==="promise")&&d._isFunction(e[s])};h=function(x,y){var t,u,v,w,s;t=function(B,C,A){var z;if((A!=null)&&!(C!=null)){return A}if(!(A!=null)&&!(C!=null)){throw"No Role method or Object method '"+B+"' found."}if(!(A!=null)){e.__isBound[x][B]=true}else{e.__isBound[x][B]=A}z=function(){var D,E;if(!(A!=null)){return C.apply(y,arguments)}E=arguments.callee.caller.__contextMethod;D=E===true||E===x;if(D){return C.apply(y,arguments)}else{return A.apply(y,arguments)}};z.__context=e;return z};u=e.__isBound[x].__rolePlayer;if((u!=null)&&u!==y){d.unbind(e,x)}s=e.constructor.prototype[x];for(v in s){w=s[v];if(d._isRoleMethod(v,w)){y[v]=t(v,w,y[v])}}return e[x]=y};i=function(){var t,s;s=[];for(t in e.__isBound){s.push(h(t,e.__isBound[t].__rolePlayer))}return s};g=function(s){return function(){var t,u,v;t=r[f];u=e.promise;r[f]=e;if(!(e.promise!=null)||!d.isPromise(e.promise)){e.promise=d.promise();d.unbindPromise(e.promise).call(e.promise,function(){return d.unbind(e)})}i();v=null;try{v=e.constructor.prototype[s].apply(e,arguments);return v}finally{if(!(v!=null)||!d.isPromise(v)){d.unbind(e);if(t===void 0){delete r[f]}else{r[f]=t}if(u!==e.promise){if(u===void 0){delete e.promise}else{e.promise=u}}}}}};m=e.constructor.prototype;if(!(m.__isProtoBound!=null)){m.__isProtoBound=true;p={};for(l in m){j=m[l];if(k(l)){m[l].__contextMethod=true}else{if(d._isRoleObject(j)){q=l;for(o in j){n=j[o];if(!(d._isRoleMethod(o,n))){continue}m[l][o].__contextMethod=q;if(p[o]!=null){throw"Method name conflict in Roles '"+p[o]+"' and '"+q+"."+o+"'. Please prepend the Role names to the methods to avoid conflict."}else{p[o]=q+"."+o}}}}}}if(!(e.__isBound!=null)){e.__isBound={};m=e.constructor.prototype;for(l in m){j=m[l];if(k(l)){e[l]=g(l)}}}return{to:function(v){var s,t,u;q=null;for(l in e){j=e[l];if(j===v){q=l;break}}if(!q){throw"Role for RolePlayer not found in Context."}if(v._contract!=null){u=v._contract;for(s=0,t=u.length;s<t;s++){l=u[s];if(!(l in r)){throw"RolePlayer "+r+" didn't fulfill Role Contract with property '"+l+"'."}}}return e.__isBound[q]={__rolePlayer:r}}}};d.unbind=function(f,g){var h,i,e;if(g==null){g=null}i=function(l){var k,m,n,j;n=f.__isBound[l].__rolePlayer;j=f.__isBound[l];for(m in j){k=j[m];if(m!=="__rolePlayer"){if(k===true){delete n[m]}else{n[m]=k}}}return f.__isBound[l]={__rolePlayer:n}};if(!(g!=null)){e=[];for(h in f.__isBound){e.push(i(h))}return e}else{return i(g)}};return d})();if(this.promise==null){(function(k){function l(d,e){return function(){return d.apply(e,arguments)}}function m(){this._callbacks=[]}m.prototype.then=function(e,f){var g=l(e,f);if(this._isdone){g(this.error,this.result)}else{this._callbacks.push(g)}};m.prototype.done=function(d,e){this._isdone=true;this.error=d;this.result=e;for(var f=0;f<this._callbacks.length;f++){this._callbacks[f](d,e)}this._callbacks=[]};function n(j){var u=j.length;var v=0;var w=new m();var x=[];var y=[];function z(d){return function(e,f){v+=1;x[d]=e;y[d]=f;if(v===u){w.done(x,y)}}}for(var A=0;A<u;A++){j[A]().then(z(A))}return w}function o(e,g,h){var i=new m();if(e.length===0){i.done(g,h)}else{e[0](g,h).then(function(d,f){e.splice(0,1);o(e,d,f).then(function(j,u){i.done(j,u)})})}return i}function p(e){var f="";if(typeof e==="string"){f=e}else{var g=encodeURIComponent;for(var h in e){if(e.hasOwnProperty(h)){f+="&"+g(h)+"="+g(e[h])}}}return f}function q(){var d;if(window.XMLHttpRequest){d=new XMLHttpRequest()}else{if(window.ActiveXObject){try{d=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){d=new ActiveXObject("Microsoft.XMLHTTP")}}}return d}function r(f,g,u,v){var w=new m();var x,y;u=u||{};v=v||{};try{x=q()}catch(z){w.done(-1,"");return w}y=p(u);if(f==="GET"&&y){g+="?"+y;y=null}x.open(f,g);x.setRequestHeader("Content-type","application/x-www-form-urlencoded");for(var A in v){if(v.hasOwnProperty(A)){x.setRequestHeader(A,v[A])}}x.onreadystatechange=function(){if(x.readyState===4){if(x.status===200){w.done(null,x.responseText)}else{w.done(x.status,"")}}};x.send(y);return w}function s(d){return function(e,f,g){return r(d,e,f,g)}}var t={Promise:m,join:n,chain:o,ajax:r,get:s("GET"),post:s("POST"),put:s("PUT"),del:s("DELETE")};if(typeof define==="function"&&define.amd){define(function(){return t})}else{k.promise=t}})(this)}}).call(this);